<dom-module id="ngrt-documents">
  <style include="shared-styles"></style>
  <style is="custom-style">

    :host {
      width: 100%;
      height:100%;
    }

  </style>

  <template>
    <paper-header-panel class="appPanel">

      <!--Toolbar-->
      <paper-toolbar class="appToolbar" >

        <!--Top-->
        <paper-icon-button id="paperToggle" icon="menu" paper-drawer-toggle></paper-icon-button>
        <span class="title">Upload</span>
        <span class="flex"></span>
        <pa-search></pa-search>
        <paper-icon-button icon="icons:settings" ></paper-icon-button>
      </paper-toolbar>

      <!--Content-->
      <div class="content fit">
        <div class="innerblock">

          <div class="documenttoolbar horizontal layout">
            <iron-ajax id="ajaxSign" url="/documents/post-tx-record" handle-as="json" method="POST"
                       content-type="application/json" debounce-duration="300"></iron-ajax>
            <iron-grid>
              <div class="m6 s12 xs12">
                <file-upload id="uploadSave" target="/upload-document" method="post"
                             upload="true" class="flex-4 horizontal layout uploadbox">Upload
                  File
                </file-upload>
              </div>
              <div class="m6 s12 xs12">
                <file-upload id="uploadVerify" target="/upload-document/verify" method="post"
                             verify="true" class="flex-4 horizontal layout uploadbox">Verify
                  File
                </file-upload>
              </div>
            </iron-grid>

            <paper-toast id="toastVerify" text=""></paper-toast>

          </div>

          <div class="documentslistblock">
            <ngrt-documents-list></ngrt-documents-list>
          </div>
        </div>
      </div>



      <!--Scripts-->
      <script type="application/javascript">
        document.addEventListener('WebComponentsReady', function () {
          // upload
          var uploadSave = document.querySelector('#uploadSave');
          uploadSave.addEventListener('before-upload', function(){
            var pubKey = project.KeysService.getDefault().pubkey;
            if (pubKey) {
              uploadSave.additional.ownerPubKey = pubKey;
            }
          });

          // verify
          var toast = document.querySelector('#toastVerify');
          var uploadVerify = document.querySelector('#uploadVerify');
          uploadVerify.addEventListener('success', function (evt) {
            toast.fitInto = uploadVerify;
            var exists = JSON.parse(evt.detail.xhr.response).exists;
            if (exists)
              toast.show("The document exists.");
            else
              toast.show("No such document.");
          });

        });

      </script>

    </paper-header-panel>



  </template>
  <script>
    Polymer({
      is: 'ngrt-documents',
      properties : {
      },
      ready: function() {
      }
    });

  </script>
</dom-module>
